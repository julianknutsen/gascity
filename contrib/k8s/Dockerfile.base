# Gas City agent base image â€” system dependencies.
#
# Contains everything an agent needs EXCEPT gc/bd/br binaries: OS packages,
# Node.js, Claude Code CLI, Dolt. Rebuild only when system dependencies
# change (~2.5 min). Agent image rebuilds on top take ~5s.
#
# Build:
#   make docker-base
#   # or: docker build -f contrib/k8s/Dockerfile.base -t gc-agent-base:latest .

FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

# System packages.
RUN apt-get update && apt-get install -y --no-install-recommends \
    bash \
    ca-certificates \
    curl \
    git \
    jq \
    procps \
    tmux \
    && rm -rf /var/lib/apt/lists/*

# Node.js (for Claude Code CLI).
RUN curl -fsSL https://deb.nodesource.com/setup_22.x | bash - \
    && apt-get install -y --no-install-recommends nodejs \
    && rm -rf /var/lib/apt/lists/*

# Claude Code CLI.
RUN npm install -g @anthropic-ai/claude-code

# Dolt CLI.
RUN curl -fsSL https://github.com/dolthub/dolt/releases/latest/download/install.sh | bash

# Non-root user for Claude Code (--dangerously-skip-permissions rejects root).
RUN useradd -m -s /bin/bash gcagent
ENV HOME=/home/gcagent
