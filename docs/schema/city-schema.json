{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/steveyegge/gascity/internal/config/city",
  "$ref": "#/$defs/City",
  "$defs": {
    "Agent": {
      "properties": {
        "name": {
          "type": "string",
          "description": "Name is the unique identifier for this agent."
        },
        "dir": {
          "type": "string",
          "description": "Dir is the working directory for the agent session."
        },
        "suspended": {
          "type": "boolean",
          "description": "Suspended prevents the reconciler from spawning this agent. Toggle with gc agent suspend/resume."
        },
        "pre_start": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "PreStart is a list of shell commands run before session creation.\nCommands run on the target filesystem: locally for tmux, inside the\npod/container for exec providers. Template variables same as session_setup."
        },
        "prompt_template": {
          "type": "string",
          "description": "PromptTemplate is the path to this agent's prompt template file.\nRelative paths resolve against the city directory."
        },
        "nudge": {
          "type": "string",
          "description": "Nudge is text typed into the agent's tmux session after startup.\nUsed for CLI agents that don't accept command-line prompts."
        },
        "provider": {
          "type": "string",
          "description": "Provider names the provider preset to use for this agent."
        },
        "start_command": {
          "type": "string",
          "description": "StartCommand overrides the provider's command for this agent."
        },
        "args": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Args overrides the provider's default arguments."
        },
        "prompt_mode": {
          "type": "string",
          "enum": [
            "arg",
            "flag",
            "none"
          ],
          "description": "PromptMode controls how prompts are delivered: \"arg\", \"flag\", or \"none\".",
          "default": "arg"
        },
        "prompt_flag": {
          "type": "string",
          "description": "PromptFlag is the CLI flag used to pass prompts when prompt_mode is \"flag\"."
        },
        "ready_delay_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "ReadyDelayMs is milliseconds to wait after launch before considering the agent ready."
        },
        "ready_prompt_prefix": {
          "type": "string",
          "description": "ReadyPromptPrefix is the string prefix that indicates the agent is ready for input."
        },
        "process_names": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "ProcessNames lists process names to look for when checking if the agent is running."
        },
        "emits_permission_warning": {
          "type": "boolean",
          "description": "EmitsPermissionWarning indicates whether the agent emits permission prompts that should be suppressed."
        },
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object",
          "description": "Env sets additional environment variables for the agent process."
        },
        "pool": {
          "$ref": "#/$defs/PoolConfig",
          "description": "Pool configures elastic pool behavior. When set, the agent becomes a pool."
        },
        "work_query": {
          "type": "string",
          "description": "WorkQuery is the shell command to find available work for this agent.\nUsed by gc hook and available in prompt templates as {{.WorkQuery}}.\nDefault for fixed agents: \"bd ready --assignee=\u003cqualified-name\u003e\".\nDefault for pool agents: \"bd ready --label=pool:\u003cqualified-name\u003e --limit=1\".\nOverride to integrate with external task systems."
        },
        "sling_query": {
          "type": "string",
          "description": "SlingQuery is the command template to route a bead to this agent/pool.\nUsed by gc sling to make a bead visible to the target's work_query.\nThe placeholder {} is replaced with the bead ID at runtime.\nDefault for fixed agents: \"bd update {} --assignee=\u003cqualified-name\u003e\".\nDefault for pool agents: \"bd update {} --label=pool:\u003cqualified-name\u003e\".\nPool agents must set both sling_query and work_query, or neither."
        },
        "idle_timeout": {
          "type": "string",
          "description": "IdleTimeout is the maximum time an agent session can be inactive before\nthe controller kills and restarts it. Duration string (e.g., \"15m\", \"1h\").\nEmpty (default) disables idle checking."
        },
        "install_agent_hooks": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "InstallAgentHooks overrides workspace-level install_agent_hooks for this agent.\nWhen set, replaces (not adds to) the workspace default."
        },
        "hooks_installed": {
          "type": "boolean",
          "description": "HooksInstalled overrides automatic hook detection. Set to true when hooks\nare manually installed (e.g., merged into the project's own hook config)\nand auto-installation via install_agent_hooks is not desired. When true,\nthe agent is treated as hook-enabled for startup behavior: no prime\ninstruction in beacon and no delayed nudge. Interacts with\ninstall_agent_hooks — set this instead when hooks are pre-installed."
        },
        "session_setup": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "SessionSetup is a list of shell commands run after session creation.\nEach command is a template string supporting placeholders:\n{{.Session}}, {{.Agent}}, {{.Rig}}, {{.CityRoot}}, {{.CityName}}, {{.WorkDir}}.\nCommands run in gc's process (not inside the agent session) via sh -c."
        },
        "session_setup_script": {
          "type": "string",
          "description": "SessionSetupScript is the path to a script run after session_setup commands.\nRelative paths resolve against the city directory. The script receives\ncontext via environment variables (GC_SESSION plus existing GC_* vars)."
        },
        "overlay_dir": {
          "type": "string",
          "description": "OverlayDir is a directory whose contents are recursively copied (additive)\ninto the agent's working directory at startup. Existing files are not\noverwritten. Relative paths resolve against the declaring config file's\ndirectory (topology-safe)."
        },
        "default_sling_formula": {
          "type": "string",
          "description": "DefaultSlingFormula is the formula name automatically applied via --on\nwhen beads are slung to this agent, unless --no-formula is set.\nExample: \"mol-polecat-work\""
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name"
      ],
      "description": "Agent defines a configured agent in the city."
    },
    "AgentOverride": {
      "properties": {
        "agent": {
          "type": "string",
          "description": "Agent is the name of the topology agent to override (required)."
        },
        "dir": {
          "type": "string",
          "description": "Dir overrides the stamped dir (default: rig name)."
        },
        "suspended": {
          "type": "boolean",
          "description": "Suspended sets the agent's suspended state."
        },
        "pool": {
          "$ref": "#/$defs/PoolOverride",
          "description": "Pool overrides pool configuration fields."
        },
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object",
          "description": "Env adds or overrides environment variables."
        },
        "env_remove": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "EnvRemove lists env var keys to remove."
        },
        "pre_start": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "PreStart overrides the agent's pre_start commands."
        },
        "prompt_template": {
          "type": "string",
          "description": "PromptTemplate overrides the prompt template path.\nRelative paths resolve against the city directory."
        },
        "provider": {
          "type": "string",
          "description": "Provider overrides the provider name."
        },
        "start_command": {
          "type": "string",
          "description": "StartCommand overrides the start command."
        },
        "nudge": {
          "type": "string",
          "description": "Nudge overrides the nudge text."
        },
        "idle_timeout": {
          "type": "string",
          "description": "IdleTimeout overrides the idle timeout duration string (e.g., \"30s\", \"5m\", \"1h\")."
        },
        "install_agent_hooks": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "InstallAgentHooks overrides the agent's install_agent_hooks list."
        },
        "hooks_installed": {
          "type": "boolean",
          "description": "HooksInstalled overrides automatic hook detection."
        },
        "session_setup": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "SessionSetup overrides the agent's session_setup commands."
        },
        "session_setup_script": {
          "type": "string",
          "description": "SessionSetupScript overrides the agent's session_setup_script path.\nRelative paths resolve against the city directory."
        },
        "overlay_dir": {
          "type": "string",
          "description": "OverlayDir overrides the agent's overlay_dir path. Copies contents\nadditively into the agent's working directory at startup.\nRelative paths resolve against the city directory."
        },
        "default_sling_formula": {
          "type": "string",
          "description": "DefaultSlingFormula overrides the default sling formula."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "agent"
      ],
      "description": "AgentOverride modifies a topology-stamped agent for a specific rig."
    },
    "AgentPatch": {
      "properties": {
        "dir": {
          "type": "string",
          "description": "Dir is the targeting key (required with Name). Identifies the agent's\nworking directory scope. Empty for city-scoped agents."
        },
        "name": {
          "type": "string",
          "description": "Name is the targeting key (required). Must match an existing agent's name."
        },
        "suspended": {
          "type": "boolean",
          "description": "Suspended overrides the agent's suspended state."
        },
        "pool": {
          "$ref": "#/$defs/PoolOverride",
          "description": "Pool overrides pool configuration fields."
        },
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object",
          "description": "Env adds or overrides environment variables."
        },
        "env_remove": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "EnvRemove lists env var keys to remove after merging."
        },
        "pre_start": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "PreStart overrides the agent's pre_start commands."
        },
        "prompt_template": {
          "type": "string",
          "description": "PromptTemplate overrides the prompt template path.\nRelative paths resolve against the city directory."
        },
        "provider": {
          "type": "string",
          "description": "Provider overrides the provider name."
        },
        "start_command": {
          "type": "string",
          "description": "StartCommand overrides the start command."
        },
        "nudge": {
          "type": "string",
          "description": "Nudge overrides the nudge text."
        },
        "idle_timeout": {
          "type": "string",
          "description": "IdleTimeout overrides the idle timeout. Duration string (e.g., \"30s\", \"5m\", \"1h\")."
        },
        "install_agent_hooks": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "InstallAgentHooks overrides the agent's install_agent_hooks list."
        },
        "hooks_installed": {
          "type": "boolean",
          "description": "HooksInstalled overrides automatic hook detection."
        },
        "session_setup": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "SessionSetup overrides the agent's session_setup commands."
        },
        "session_setup_script": {
          "type": "string",
          "description": "SessionSetupScript overrides the agent's session_setup_script path.\nRelative paths resolve against the city directory."
        },
        "overlay_dir": {
          "type": "string",
          "description": "OverlayDir overrides the agent's overlay_dir path. Copies contents\nadditively into the agent's working directory at startup.\nRelative paths resolve against the city directory."
        },
        "default_sling_formula": {
          "type": "string",
          "description": "DefaultSlingFormula overrides the default sling formula."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "dir",
        "name"
      ],
      "description": "AgentPatch modifies an existing agent identified by (Dir, Name)."
    },
    "AutomationOverride": {
      "properties": {
        "name": {
          "type": "string",
          "description": "Name is the automation name to target (required)."
        },
        "rig": {
          "type": "string",
          "description": "Rig scopes the override to a specific rig's automation.\nEmpty matches city-level automations."
        },
        "enabled": {
          "type": "boolean",
          "description": "Enabled overrides whether the automation is active."
        },
        "gate": {
          "type": "string",
          "description": "Gate overrides the gate type."
        },
        "interval": {
          "type": "string",
          "description": "Interval overrides the cooldown interval. Go duration string."
        },
        "schedule": {
          "type": "string",
          "description": "Schedule overrides the cron expression."
        },
        "check": {
          "type": "string",
          "description": "Check overrides the condition gate check command."
        },
        "on": {
          "type": "string",
          "description": "On overrides the event gate event type."
        },
        "pool": {
          "type": "string",
          "description": "Pool overrides the target agent/pool."
        },
        "timeout": {
          "type": "string",
          "description": "Timeout overrides the per-automation timeout. Go duration string."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name"
      ],
      "description": "AutomationOverride modifies a scanned automation's scheduling fields."
    },
    "AutomationsConfig": {
      "properties": {
        "skip": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Skip lists automation names to exclude from scanning."
        },
        "max_timeout": {
          "type": "string",
          "description": "MaxTimeout is an operator hard cap on per-automation timeouts.\nNo automation gets more than this duration. Go duration string (e.g., \"60s\").\nEmpty means uncapped (no override)."
        },
        "overrides": {
          "items": {
            "$ref": "#/$defs/AutomationOverride"
          },
          "type": "array",
          "description": "Overrides apply per-automation field overrides after scanning.\nEach override targets an automation by name and optionally by rig."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "AutomationsConfig holds automation settings."
    },
    "BeadsConfig": {
      "properties": {
        "provider": {
          "type": "string",
          "description": "Provider selects the bead store backend: \"bd\" (default), \"file\",\nor \"exec:\u003cscript\u003e\" for a user-supplied script.",
          "default": "bd"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "BeadsConfig holds bead store settings."
    },
    "City": {
      "properties": {
        "include": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Include lists config fragment files to merge into this config.\nProcessed by LoadWithIncludes; not recursive (fragments cannot include)."
        },
        "workspace": {
          "$ref": "#/$defs/Workspace",
          "description": "Workspace holds city-level metadata (name, default provider)."
        },
        "providers": {
          "additionalProperties": {
            "$ref": "#/$defs/ProviderSpec"
          },
          "type": "object",
          "description": "Providers defines named provider presets for agent startup."
        },
        "topologies": {
          "additionalProperties": {
            "$ref": "#/$defs/TopologySource"
          },
          "type": "object",
          "description": "Topologies defines named remote topology sources fetched via git."
        },
        "agents": {
          "items": {
            "$ref": "#/$defs/Agent"
          },
          "type": "array",
          "description": "Agents lists all configured agents in this city."
        },
        "rigs": {
          "items": {
            "$ref": "#/$defs/Rig"
          },
          "type": "array",
          "description": "Rigs lists external projects registered in the city."
        },
        "patches": {
          "$ref": "#/$defs/Patches",
          "description": "Patches holds targeted modifications applied after fragment merge."
        },
        "beads": {
          "$ref": "#/$defs/BeadsConfig",
          "description": "Beads configures the bead store backend."
        },
        "session": {
          "$ref": "#/$defs/SessionConfig",
          "description": "Session configures the session provider backend."
        },
        "mail": {
          "$ref": "#/$defs/MailConfig",
          "description": "Mail configures the mail provider backend."
        },
        "events": {
          "$ref": "#/$defs/EventsConfig",
          "description": "Events configures the events provider backend."
        },
        "dolt": {
          "$ref": "#/$defs/DoltConfig",
          "description": "Dolt configures optional dolt server connection overrides."
        },
        "formulas": {
          "$ref": "#/$defs/FormulasConfig",
          "description": "Formulas configures formula directory settings."
        },
        "daemon": {
          "$ref": "#/$defs/DaemonConfig",
          "description": "Daemon configures controller daemon settings."
        },
        "automations": {
          "$ref": "#/$defs/AutomationsConfig",
          "description": "Automations configures automation settings (skip list)."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "workspace",
        "agents"
      ],
      "description": "City is the top-level configuration for a Gas City instance."
    },
    "DaemonConfig": {
      "properties": {
        "patrol_interval": {
          "type": "string",
          "description": "PatrolInterval is the health patrol interval. Duration string (e.g., \"30s\", \"5m\", \"1h\"). Defaults to \"30s\".",
          "default": "30s"
        },
        "max_restarts": {
          "type": "integer",
          "description": "MaxRestarts is the maximum number of agent restarts within RestartWindow before\nthe agent is quarantined. 0 means unlimited (no crash loop detection). Defaults to 5.",
          "default": 5
        },
        "restart_window": {
          "type": "string",
          "description": "RestartWindow is the sliding time window for counting restarts.\nDuration string (e.g., \"30s\", \"5m\", \"1h\"). Defaults to \"1h\".",
          "default": "1h"
        },
        "shutdown_timeout": {
          "type": "string",
          "description": "ShutdownTimeout is the time to wait after sending Ctrl-C before force-killing\nagents during shutdown. Duration string (e.g., \"5s\", \"30s\"). Set to \"0s\"\nfor immediate kill. Defaults to \"5s\".",
          "default": "5s"
        },
        "wisp_gc_interval": {
          "type": "string",
          "description": "WispGCInterval is how often wisp GC runs. Duration string (e.g., \"5m\", \"1h\").\nWisp GC is disabled unless both WispGCInterval and WispTTL are set."
        },
        "wisp_ttl": {
          "type": "string",
          "description": "WispTTL is how long a closed molecule survives before being purged.\nDuration string (e.g., \"24h\", \"7d\"). Wisp GC is disabled unless both\nWispGCInterval and WispTTL are set."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "DaemonConfig holds controller daemon settings."
    },
    "DoltConfig": {
      "properties": {
        "port": {
          "type": "integer",
          "description": "Port is the dolt server port. Defaults to 3307.",
          "default": 3307
        },
        "host": {
          "type": "string",
          "description": "Host is the dolt server hostname. Defaults to localhost.",
          "default": "localhost"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "DoltConfig holds optional dolt server overrides."
    },
    "EventsConfig": {
      "properties": {
        "provider": {
          "type": "string",
          "description": "Provider selects the events backend: \"fake\", \"fail\",\n\"exec:\u003cscript\u003e\", or \"\" (default: file-backed JSONL)."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "EventsConfig holds events provider settings."
    },
    "FormulasConfig": {
      "properties": {
        "dir": {
          "type": "string",
          "description": "Dir is the path to the formulas directory. Defaults to \".gc/formulas\".",
          "default": ".gc/formulas"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "FormulasConfig holds formula directory settings."
    },
    "K8sConfig": {
      "properties": {
        "namespace": {
          "type": "string",
          "description": "Namespace is the K8s namespace for agent pods. Default: \"gc\".",
          "default": "gc"
        },
        "image": {
          "type": "string",
          "description": "Image is the container image for agents."
        },
        "context": {
          "type": "string",
          "description": "Context is the kubectl/kubeconfig context. Default: current."
        },
        "cpu_request": {
          "type": "string",
          "description": "CPURequest is the pod CPU request. Default: \"500m\".",
          "default": "500m"
        },
        "mem_request": {
          "type": "string",
          "description": "MemRequest is the pod memory request. Default: \"1Gi\".",
          "default": "1Gi"
        },
        "cpu_limit": {
          "type": "string",
          "description": "CPULimit is the pod CPU limit. Default: \"2\".",
          "default": "2"
        },
        "mem_limit": {
          "type": "string",
          "description": "MemLimit is the pod memory limit. Default: \"4Gi\".",
          "default": "4Gi"
        },
        "prebaked": {
          "type": "boolean",
          "description": "Prebaked skips init container staging and EmptyDir volumes when true.\nUse with images built by `gc build-image` that have city content baked in."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "K8sConfig holds native K8s session provider settings."
    },
    "MailConfig": {
      "properties": {
        "provider": {
          "type": "string",
          "description": "Provider selects the mail backend: \"fake\", \"fail\",\n\"exec:\u003cscript\u003e\", or \"\" (default: beadmail)."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "MailConfig holds mail provider settings."
    },
    "Patches": {
      "properties": {
        "agents": {
          "items": {
            "$ref": "#/$defs/AgentPatch"
          },
          "type": "array",
          "description": "Agents targets agents by (dir, name)."
        },
        "rigs": {
          "items": {
            "$ref": "#/$defs/RigPatch"
          },
          "type": "array",
          "description": "Rigs targets rigs by name."
        },
        "providers": {
          "items": {
            "$ref": "#/$defs/ProviderPatch"
          },
          "type": "array",
          "description": "Providers targets providers by name."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "Patches holds all patch blocks from composition."
    },
    "PoolConfig": {
      "properties": {
        "min": {
          "type": "integer",
          "minimum": 0,
          "description": "Min is the minimum number of pool instances. Defaults to 0.",
          "default": 0
        },
        "max": {
          "type": "integer",
          "minimum": 0,
          "description": "Max is the maximum number of pool instances. 0 means the pool is\ndisabled (no instances will be created). Defaults to 0.",
          "default": 0
        },
        "check": {
          "type": "string",
          "description": "Check is a shell command whose output determines desired pool size. Defaults to \"echo 1\".",
          "default": "echo 1"
        },
        "drain_timeout": {
          "type": "string",
          "description": "DrainTimeout is the maximum time to wait for a pool instance to finish its\ncurrent work before force-killing it. Duration string (e.g., \"5m\", \"30m\", \"1h\").\nDefaults to \"5m\".",
          "default": "5m"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "PoolConfig defines elastic pool parameters for an agent."
    },
    "PoolOverride": {
      "properties": {
        "min": {
          "type": "integer",
          "minimum": 0,
          "description": "Min overrides pool minimum instances."
        },
        "max": {
          "type": "integer",
          "minimum": 0,
          "description": "Max overrides pool maximum instances. 0 means the pool is disabled."
        },
        "check": {
          "type": "string",
          "description": "Check overrides the pool check command."
        },
        "drain_timeout": {
          "type": "string",
          "description": "DrainTimeout overrides the drain timeout. Duration string (e.g., \"5m\", \"30m\", \"1h\")."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "PoolOverride modifies pool configuration fields."
    },
    "ProviderPatch": {
      "properties": {
        "name": {
          "type": "string",
          "description": "Name is the targeting key (required). Must match an existing provider's name."
        },
        "command": {
          "type": "string",
          "description": "Command overrides the provider command."
        },
        "args": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Args overrides the provider args."
        },
        "prompt_mode": {
          "type": "string",
          "enum": [
            "arg",
            "flag",
            "none"
          ],
          "description": "PromptMode overrides prompt delivery mode."
        },
        "prompt_flag": {
          "type": "string",
          "description": "PromptFlag overrides the prompt flag."
        },
        "ready_delay_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "ReadyDelayMs overrides the ready delay in milliseconds."
        },
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object",
          "description": "Env adds or overrides environment variables."
        },
        "env_remove": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "EnvRemove lists env var keys to remove."
        },
        "_replace": {
          "type": "boolean",
          "description": "Replace replaces the entire provider block instead of deep-merging."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name"
      ],
      "description": "ProviderPatch modifies an existing provider identified by Name."
    },
    "ProviderSpec": {
      "properties": {
        "display_name": {
          "type": "string",
          "description": "DisplayName is the human-readable name shown in UI and logs."
        },
        "command": {
          "type": "string",
          "description": "Command is the executable to run for this provider."
        },
        "args": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Args are default command-line arguments passed to the provider."
        },
        "prompt_mode": {
          "type": "string",
          "enum": [
            "arg",
            "flag",
            "none"
          ],
          "description": "PromptMode controls how prompts are delivered: \"arg\", \"flag\", or \"none\".",
          "default": "arg"
        },
        "prompt_flag": {
          "type": "string",
          "description": "PromptFlag is the CLI flag used when prompt_mode is \"flag\" (e.g. \"--prompt\")."
        },
        "ready_delay_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "ReadyDelayMs is milliseconds to wait after launch before the provider is considered ready."
        },
        "ready_prompt_prefix": {
          "type": "string",
          "description": "ReadyPromptPrefix is the string prefix that indicates the provider is ready for input."
        },
        "process_names": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "ProcessNames lists process names to look for when checking if the provider is running."
        },
        "emits_permission_warning": {
          "type": "boolean",
          "description": "EmitsPermissionWarning indicates whether the provider emits permission prompts."
        },
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object",
          "description": "Env sets additional environment variables for the provider process."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "ProviderSpec defines a named provider's startup parameters."
    },
    "Rig": {
      "properties": {
        "name": {
          "type": "string",
          "description": "Name is the unique identifier for this rig."
        },
        "path": {
          "type": "string",
          "description": "Path is the absolute filesystem path to the rig's repository."
        },
        "prefix": {
          "type": "string",
          "description": "Prefix overrides the auto-derived bead ID prefix for this rig."
        },
        "suspended": {
          "type": "boolean",
          "description": "Suspended prevents the reconciler from spawning agents in this rig. Toggle with gc rig suspend/resume."
        },
        "topology": {
          "type": "string",
          "description": "Topology is the path to a topology directory to stamp agents from.\nRelative paths resolve against the declaring config file's directory."
        },
        "topologies": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "RigTopologies lists multiple topology directories for this rig.\nEach is loaded and expanded like Topology. When both Topology and\nRigTopologies are set, Topology is prepended to the list."
        },
        "formulas_dir": {
          "type": "string",
          "description": "FormulasDir is a rig-local formula directory (Layer 4). Overrides\ntopology formulas for this rig by filename.\nRelative paths resolve against the city directory."
        },
        "overrides": {
          "items": {
            "$ref": "#/$defs/AgentOverride"
          },
          "type": "array",
          "description": "Overrides are per-agent patches applied after topology expansion."
        },
        "default_sling_target": {
          "type": "string",
          "description": "DefaultSlingTarget is the agent qualified name used when gc sling is\ninvoked with only a bead ID (no explicit target). Resolved via\nresolveAgentIdentity. Example: \"rig/polecat\""
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name",
        "path"
      ],
      "description": "Rig defines an external project registered in the city."
    },
    "RigPatch": {
      "properties": {
        "name": {
          "type": "string",
          "description": "Name is the targeting key (required). Must match an existing rig's name."
        },
        "path": {
          "type": "string",
          "description": "Path overrides the rig's filesystem path."
        },
        "prefix": {
          "type": "string",
          "description": "Prefix overrides the bead ID prefix."
        },
        "suspended": {
          "type": "boolean",
          "description": "Suspended overrides the rig's suspended state."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name"
      ],
      "description": "RigPatch modifies an existing rig identified by Name."
    },
    "SessionConfig": {
      "properties": {
        "provider": {
          "type": "string",
          "description": "Provider selects the session backend: \"fake\", \"fail\", \"subprocess\",\n\"exec:\u003cscript\u003e\", \"k8s\", or \"\" (default: tmux)."
        },
        "k8s": {
          "$ref": "#/$defs/K8sConfig",
          "description": "K8s holds Kubernetes-specific settings for the native K8s provider."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "description": "SessionConfig holds session provider settings."
    },
    "TopologySource": {
      "properties": {
        "source": {
          "type": "string",
          "description": "Source is the git repository URL."
        },
        "ref": {
          "type": "string",
          "description": "Ref is the git ref to checkout (branch, tag, or commit). Defaults to HEAD."
        },
        "path": {
          "type": "string",
          "description": "Path is a subdirectory within the repo containing the topology files."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "source"
      ],
      "description": "TopologySource defines a remote topology repository."
    },
    "Workspace": {
      "properties": {
        "name": {
          "type": "string",
          "description": "Name is the human-readable name for this city."
        },
        "provider": {
          "type": "string",
          "description": "Provider is the default provider name used by agents that don't specify one."
        },
        "start_command": {
          "type": "string",
          "description": "StartCommand overrides the provider's command for all agents."
        },
        "suspended": {
          "type": "boolean",
          "description": "Suspended controls whether the city is suspended. When true, all\nagents are effectively suspended: the reconciler won't spawn them,\nand gc hook/prime return empty. Inherits downward — individual\nagent/rig suspended fields are checked independently."
        },
        "session_template": {
          "type": "string",
          "description": "SessionTemplate is a template string supporting placeholders: {{.City}},\n{{.Agent}} (sanitized), {{.Dir}}, {{.Name}}. Controls tmux session naming.\nDefault (empty): \"gc-{{.City}}-{{.Agent}}\"."
        },
        "install_agent_hooks": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "InstallAgentHooks lists provider names whose hooks should be installed\ninto agent working directories. Agent-level overrides workspace-level\n(replace, not additive). Supported: \"claude\", \"gemini\", \"opencode\", \"copilot\"."
        },
        "topology": {
          "type": "string",
          "description": "Topology is the path to a city-level topology directory.\nStamps agents with dir=\"\" (city-scoped). Resolved like rig topologies.\nCombined with rig-level topologies — city topology agents get dir=\"\"\nwhile rig topology agents inherit the rig name as their dir."
        },
        "topologies": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "CityTopologies lists multiple city-level topology directories.\nEach is loaded and expanded like Topology. When both Topology and\nCityTopologies are set, Topology is prepended to the list.\nAgents from the first topology come first (deterministic ordering)."
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name"
      ],
      "description": "Workspace holds city-level metadata and optional defaults that apply to all agents unless overridden per-agent."
    }
  },
  "title": "Gas City Configuration",
  "description": "Schema for city.toml — the top-level configuration file for a Gas City instance."
}
