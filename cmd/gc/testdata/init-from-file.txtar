# gc init --file with a TOML file path.

env GC_SESSION=fake
env GC_BEADS=file
env GC_DOLT=skip

# Init from a TOML file.
exec gc init --file $WORK/configs/08-agent-pools.toml $WORK/my-city
stdout 'Welcome to Gas City!'
stdout 'Initialized city'
stdout '08-agent-pools.toml'

# Verify city starts with the pool config.
exec gc start $WORK/my-city
stdout 'Pool .worker.: starting 3 agent'
stdout 'City started.'

# gc agent list shows the pool info.
cd $WORK/my-city
exec gc agent list
stdout 'worker .pool: min=0, max=5.'

# gc init --file rejects already-initialized city.
! exec gc init --file $WORK/configs/08-agent-pools.toml $WORK/my-city
stderr 'already initialized'

# gc init --file with nonexistent file.
! exec gc init --file $WORK/nonexistent.toml $WORK/new-city
stderr 'reading'

# gc init --file with invalid TOML.
! exec gc init --file $WORK/configs/bad.toml $WORK/bad-city
stderr 'parsing'

-- configs/08-agent-pools.toml --
[workspace]
name = "placeholder"

[[agents]]
name = "mayor"
start_command = "echo hello"

[[agents]]
name = "worker"
start_command = "echo hello"

[agents.pool]
min = 0
max = 5
check = "echo 3"

-- configs/bad.toml --
[[[invalid toml
