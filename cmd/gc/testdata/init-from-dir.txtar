# gc init --from copies an example directory to bootstrap a city.

env GC_SESSION=fake
env GC_BEADS=file
env GC_DOLT=skip

# Init from the template directory.
exec gc init --from $WORK/template $WORK/my-city
stdout 'Welcome to Gas City!'
stdout 'Initialized city'
stdout 'my-city'
stdout 'template'

# Verify city.toml exists and name was updated.
exists $WORK/my-city/city.toml
exec grep 'my-city' $WORK/my-city/city.toml

# Verify files were copied.
exists $WORK/my-city/prompts/mayor.md

# Verify .gc/ was created.
exists $WORK/my-city/.gc

# Verify _test.go files were skipped.
! exists $WORK/my-city/example_test.go

# Verify source .gc/ was not copied.
! exists $WORK/my-city/.gc/old-state.json

# gc init --from rejects already-initialized city.
! exec gc init --from $WORK/template $WORK/my-city
stderr 'already initialized'

# gc init --from rejects source without city.toml.
! exec gc init --from $WORK/no-city $WORK/new-city
stderr 'no city.toml'

# gc init --from and --file are mutually exclusive (exits non-zero).
! exec gc init --from $WORK/template --file $WORK/template/city.toml $WORK/other-city

-- template/city.toml --
[workspace]
name = "template"
provider = "claude"

[[agents]]
name = "mayor"
prompt_template = "prompts/mayor.md"

-- template/prompts/mayor.md --
You are the mayor.

-- template/example_test.go --
package test

-- template/.gc/old-state.json --
{"stale": true}

-- no-city/.keep --
