# Formulas â€” list and show
#
# Validates gc formula list/show.
# Uses the pancakes formula (5 steps with dependencies).

env GC_BEADS=file
env GC_DOLT=skip
env GC_SESSION=fake

# Initialize city
exec gc init $WORK/bright-lights
cd $WORK/bright-lights

# Copy pancakes formula into the formulas directory
mkdir $WORK/bright-lights/.gc/formulas
cp $WORK/pancakes.formula.toml $WORK/bright-lights/.gc/formulas/pancakes.formula.toml

# --- Formula commands ---

exec gc formula list
stdout 'pancakes'

exec gc formula show pancakes
stdout 'pancakes'
stdout 'Steps:       5'
stdout 'dry'
stdout 'wet'
stdout 'combine'
stdout 'cook'
stdout 'serve'

# --- Error cases ---

! exec gc formula show nonexistent
stderr 'not found'

! exec gc formula
stderr 'missing subcommand'

-- pancakes.formula.toml --
formula = "pancakes"
description = "Make pancakes from scratch"

[[steps]]
id = "dry"
title = "Mix dry ingredients"
description = "Combine flour, sugar, baking powder, salt."

[[steps]]
id = "wet"
title = "Mix wet ingredients"
description = "Whisk eggs, milk, and melted butter together."

[[steps]]
id = "combine"
title = "Combine wet and dry"
description = "Fold wet ingredients into dry. Do not overmix."
needs = ["dry", "wet"]

[[steps]]
id = "cook"
title = "Cook the pancakes"
description = "Heat griddle to 375F. Pour 1/4 cup batter per pancake."
needs = ["combine"]

[[steps]]
id = "serve"
title = "Serve"
description = "Stack pancakes on a plate with butter and syrup."
needs = ["cook"]
