# gc doctor â€” system health diagnostics.

env GC_BEADS=file
env GC_DOLT=skip
env GC_SESSION=fake

# Doctor outside a city fails.
! exec gc doctor
stderr 'not in a city directory'

# Initialize a healthy city.
exec gc init $WORK/health-city
cd $WORK/health-city

# Create events.jsonl so that check passes.
cp $WORK/empty $WORK/health-city/.gc/events.jsonl

# Doctor on a healthy city passes.
exec gc doctor
stdout 'city-structure'
stdout 'city-config'
stdout 'tmux-binary'
stdout 'git-binary'
stdout 'controller'
stdout 'events-log'
stdout 'passed'

# Doctor with --verbose shows extra output.
exec gc doctor -v
stdout 'city-structure'

# Broken config reports errors.
cp $WORK/bad-toml $WORK/broken-city/city.toml
cd $WORK/broken-city
! exec gc doctor
stdout 'city-config'
stdout 'parse error'
stdout 'failed'

-- empty --
-- broken-city/.gc/.keep --
-- bad-toml --
{{invalid toml
