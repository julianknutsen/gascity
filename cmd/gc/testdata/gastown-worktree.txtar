# Gas Town worktree — list and clean commands.
#
# Tests worktree CLI surface. Since worktrees require real git repos,
# this test focuses on error paths and empty-state behavior.

env GC_BEADS=file
env GC_DOLT=skip
env GC_SESSION=fake

# Initialize city
exec gc init $WORK/wt-city
cd $WORK/wt-city

# --- 1. Worktree list with no worktrees → empty output ---

exec gc worktree list
! stdout '.'

# --- 2. Worktree clean with no args and no --all ---

! exec gc worktree clean
stderr 'specify paths or use --all'

# --- 3. Worktree clean --all with empty dir ---

exec gc worktree clean --all
# Should succeed with nothing to clean

# --- 4. Worktree clean --all and path args are mutually exclusive ---

! exec gc worktree clean --all /some/path
stderr 'mutually exclusive'

# --- 5. Outside city ---

cd $WORK
! exec gc worktree list
stderr 'not in a city directory'

# --- 6. Missing subcommand ---

cd $WORK/wt-city
! exec gc worktree
stderr 'missing subcommand'

# --- 7. Unknown subcommand ---

! exec gc worktree blorp
stderr 'unknown subcommand "blorp"'
