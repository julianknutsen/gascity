# Gas Town — expressed as a Gas City configuration.
#
# This proves the Gas City thesis: any orchestration topology is pure config.
# Gas Town's 7 hardcoded roles become 7 [[agents]] entries.
# All behavior lives in prompt templates and formulas.
#
# To use: gc start examples/gastown/
# Requires rigs to be registered: gc rig add <path>

[workspace]
name = "gastown"
provider = "claude"

[formulas]
dir = "formulas"

# ─────────────────────────────────────────────────────────────────────
# MAYOR — Global coordinator. One per city. Town-scoped.
# ─────────────────────────────────────────────────────────────────────
[[agents]]
name = "mayor"
prompt_template = "prompts/mayor.md.tmpl"
nudge = "Check mail and hook status, then act accordingly."

# ─────────────────────────────────────────────────────────────────────
# DEACON — Daemon beacon / patrol executor. One per city. Town-scoped.
# ─────────────────────────────────────────────────────────────────────
[[agents]]
name = "deacon"
prompt_template = "prompts/deacon.md.tmpl"
nudge = "Run 'gc prime' to check patrol status and begin heartbeat cycle."

# ─────────────────────────────────────────────────────────────────────
# WITNESS — Per-rig worker monitor. One per rig. Rig-scoped.
# Requires dir to point at a registered rig.
# ─────────────────────────────────────────────────────────────────────
# Example for one rig — duplicate this block per rig:
# [[agents]]
# name = "witness"
# dir = "/path/to/rig"
# prompt_template = "prompts/witness.md.tmpl"
# nudge = "Run 'gc prime' to check worker status and begin patrol cycle."

# ─────────────────────────────────────────────────────────────────────
# REFINERY — Merge queue processor. One per rig. Rig-scoped.
# Needs isolation = "worktree" for rebase/merge operations.
# ─────────────────────────────────────────────────────────────────────
# Example for one rig — duplicate this block per rig:
# [[agents]]
# name = "refinery"
# dir = "/path/to/rig"
# isolation = "worktree"
# prompt_template = "prompts/refinery.md.tmpl"
# nudge = "Run 'gc prime' to check merge queue and begin processing."
# [agents.env]
# DefaultBranch = "main"  # available as {{ .DefaultBranch }} in prompt template

# ─────────────────────────────────────────────────────────────────────
# POLECAT — Transient worker agents. Multiple per rig via pool.
# Needs isolation = "worktree" for sandboxed work.
# ─────────────────────────────────────────────────────────────────────
# Example for one rig — duplicate this block per rig:
# [[agents]]
# name = "polecat"
# dir = "/path/to/rig"
# isolation = "worktree"
# prompt_template = "prompts/polecat.md.tmpl"
# nudge = "Check your hook for work assignments."
# [agents.pool]
# min = 0
# max = 5
# check = "bd list --assignee polecat --status open --json 2>/dev/null | jq length 2>/dev/null || echo 0"

# ─────────────────────────────────────────────────────────────────────
# DOG — Town-level infrastructure workers. Dispatched by Deacon.
# ─────────────────────────────────────────────────────────────────────
[[agents]]
name = "dog"
prompt_template = "prompts/dog.md.tmpl"
nudge = "Check your hook for work assignments."
[agents.pool]
min = 0
max = 3
check = "bd list --assignee dog --status open --json 2>/dev/null | jq length 2>/dev/null || echo 0"

# ─────────────────────────────────────────────────────────────────────
# CREW — Persistent user-managed workspaces. Declared individually.
# Needs isolation = "worktree" for independent clone.
# ─────────────────────────────────────────────────────────────────────
# Example crew members — customize per project:
# [[agents]]
# name = "wolf"
# dir = "/path/to/rig"
# isolation = "worktree"
# prompt_template = "prompts/crew.md.tmpl"
# nudge = "Check your hook and mail, then act accordingly."
