# Swarm — flat peer topology.
#
# City agents (mayor, deacon, dog) provide the same infrastructure as Gas Town.
# Rig agents replace polecat/refinery/witness with a simpler combo: N coders
# self-organize via beads and mail, a dedicated committer handles git.
# No worktree isolation, no formulas, no witness — peers coordinate directly.
#
# Referenced by both workspace.topology and rigs[].topology:
#   workspace.topology → expands city_agents only (mayor, deacon, dog)
#   rigs[].topology    → expands rig agents only (coder, committer)

[topology]
name = "swarm"
schema = 1
city_agents = ["mayor", "deacon", "dog"]

# ── MAYOR — Global coordinator. One per city. ──────────────────────────
[[agents]]
name = "mayor"
prompt_template = "prompts/mayor.md.tmpl"
nudge = "Check mail and hook status, then act accordingly."
overlay_dir = "overlays/default"
idle_timeout = "1h"

# ── DEACON — Daemon beacon / patrol executor. One per city. ────────────
[[agents]]
name = "deacon"
prompt_template = "prompts/deacon.md.tmpl"
nudge = "Run 'gc prime' to check patrol status and begin heartbeat cycle."
overlay_dir = "overlays/default"
idle_timeout = "1h"

# ── DOG — City-level infrastructure workers. Pool. ─────────────────────
[[agents]]
name = "dog"
prompt_template = "prompts/dog.md.tmpl"
nudge = "Check your hook for work assignments."
overlay_dir = "overlays/default"
idle_timeout = "2h"

[agents.pool]
min = 0
max = 3

# ── CODER — peer worker. Pool of N. Rig-scoped. ───────────────────────
[[agents]]
name = "coder"
prompt_template = "prompts/coder.md.tmpl"
nudge = "Run bd ready --unassigned, check mail, then claim and work on a task."
overlay_dir = "overlays/default"
idle_timeout = "2h"

[agents.pool]
min = 1
max = 5

# ── COMMITTER — dedicated commit agent. Singleton. Rig-scoped. ────────
[[agents]]
name = "committer"
prompt_template = "prompts/committer.md.tmpl"
nudge = "Check for uncommitted changes and commit them in logical groupings."
overlay_dir = "overlays/default"
idle_timeout = "2h"
